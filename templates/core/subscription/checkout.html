{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout ‚Äì CloudSync</title>
    <link rel="stylesheet" href="{% static 'css/checkout.css' %}">
</head>

<body>

<div class="checkout-wrapper">

    <!-- Left Section -->
    <div class="checkout-card">

        <h2 class="title">Complete Your Subscription</h2>
        <p class="subtitle">You selected the <strong>{{ plan|title }}</strong> plan</p>

        <!-- Plan Summary Box -->
        <div class="plan-box">
            <h3>{{ plan_data.name }}</h3>
            <p class="storage">{{ plan_data.storage }} GB Cloud Storage</p>

            <ul class="feature-list">
                <li>‚úî Secure Cloud Storage</li>
                <li>‚úî Advanced File Sharing</li>
                <li>‚úî Priority Upload Speed</li>
                <li>‚úî 24/7 Customer Support</li>
            </ul>

            <div class="price-row">
                <span>Total Amount:</span>
                <strong>‚Çπ{{ amount|floatformat:2 }}</strong>
            </div>
        </div>

        <!-- Payment Button -->
        <button id="payBtn" class="pay-btn" onclick="payNow()">
            Proceed to Pay ‚Çπ{{ amount|floatformat:2 }}
        </button>

        <p class="safe-text">üîí Secure Payment via Razorpay</p>

    </div>


    <!-- Right Section (Image) -->
    <div class="checkout-image">
        <img src="{% static 'images/checkout.png' %}" alt="Checkout Illustration">
    </div>

</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
function payNow() {
    fetch("{% url 'create_order' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: new URLSearchParams({
            plan: "{{ plan }}",
            amount: "{{ amount }}"
        })
    })
    .then(res => res.json())
    .then(data => {

        var options = {
            key: data.key,
            amount: data.amount,
            currency: "INR",
            name: "CloudSync",
            description: "Subscription Payment",
            order_id: data.order_id,

            handler: function (response) {

                fetch("{% url 'payment_verify' %}", {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: new URLSearchParams({
                        razorpay_payment_id: response.razorpay_payment_id,
                        razorpay_order_id: response.razorpay_order_id,
                        razorpay_signature: response.razorpay_signature,
                        plan: "{{ plan }}"
                    })
                })
                .then(res => res.json())
                .then(result => {
                    if (result.status === "success") {
                        window.location.href = "/payment/success/";
                    } else {
                        alert("‚ùå Payment verification failed");
                    }
                });
            }
        };

        const rzp = new Razorpay(options);
        rzp.open();
    });
}
</script>


</body>
</html>
